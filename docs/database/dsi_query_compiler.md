## 查询编译器

### 查询处理器的步骤

1. **查询语句=>语法树**：对查询语句进行语法分析
2. **语法树=>逻辑查询计划**：把语法分析树转换为关系代数表达式树
3. **逻辑查询计划=>物理查询计划**：对逻辑查询计划进行等价转换，并生成等价的物理查询计划。物理查询计划指明了要执行的操作、操作的执行顺序、执行每步操作所用的算法、获取存储数据的方式、数据从一个操作传递给另一个操作的方式

### 优化器中的关系代数理论

#### 交换律和结合律

集合和包（关系）的自然连接、内连接、交、并满足交换律和结合律。

```
R × S = S × R
R ⋈ S = S ⋈ R
R ∩ S = S ∩ R
R ∪ S = S ∪ R
```

```
(R × S) × T = R × (S × T)
(R ⋈ S) ⋈ T = R ⋈ (S ⋈ T)
(R ∩ S) ∩ T = R ∩ (S ∩ T)
(R ∪ S) ∪ T = R ∪ (S ∪ T)
```

但是需要注意的是，集合满足的的一些定律，在包上不一定成立。例如：

```
//在集合上成立，在包上不成立（例如R=S=T={a}）
(R ∪ S) ∩ T = (R ∩ T) ∪ (S ∩ T)
```

#### 选择相关的定律

复杂的选择条件（使用AND或OR连接的条件）可以被分解，分解后的选择条件含有更少的属性和关系，可以更方便地移动。

```
σ{c1 AND c2}(R) = σ{c1}(σ{c2}(R))
σ{c1 OR c2}(R) = (σ{c1}(R))∪(σ{c2}(R))
```

对于二元运算符而言，也可以进行选择的下推：

- 对于并，选择必须下推到2个关系中
- 对于差，选择必须下推到第2个关系中，是否下推到第2个关系中是可选的
- 对于交、积、连接，需要下推到其中1个关系中（如果这个关系有相关属性）

选择下推是强有力的优化手段。当查询中包含视图是，有时先将选择尽量上移，然后再下推到可能的分支。

#### 投影相关的定律

只要投影所消除的属性不会被上层运算符用到，且不在关系代数表达式的结果中，就可以在表达式数的任何位置引入投影。

投影可以下推，但是注意，投影不能被推导集合的交、并、差，以及包的交、差之下（即只能在包的并场景中下推）。
