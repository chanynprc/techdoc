## 索引结构

### 索引结构基础

**索引**：以一个或多个字段的值为输入并能快速地找出具有该值得记录。

#### 稠密索引

**稠密索引**：数据文件中的每个记录在索引文件中都设有一个索引项。

如果记录是排好序的，可以在记录上建立稠密索引。索引块中存放记录的键以及指向记录本身的指针。

稠密索引的优点有：

1. 索引块数量通常比数据块数量少
2. 由于键被排序，可使用二分查找法来查找某个键，若有n个索引块，只需要查找$log_2n$个块
3. 索引文件可能足够小，以至于可能常驻主存缓冲区，从而查找某个键不需要IO操作

#### 稀疏索引

**稀疏索引**：数据文件中只有一些记录在索引文件中表示出来，通常为每个数据块在索引文件中设一个索引项。

只有数据文件是按照某个查找键排序时，在该查找键上建立的稀疏索引才能被使用。索引块中存放各数据块第一个记录的键值及数据块的地址指针。

在查找某条键值为K的记录时，先查找键值不大于K的索引项，然后根据指针找到对应的数据块，再在数据块上查找相应的记录。

#### 多级索引

**多级索引**：在某些情况下，通过在索引上再建立索引，能够使单层索引的使用更为有效。B树是一种多级索引。

#### 辅助索引

**辅助索引**：建立在非主键或者未排序的列上的索引，指向存放当前记录的地址，该存放位置由建立在其他某个字段上的主索引确定。

- 辅助索引总是稠密的
- 为了减少辅助索引的空间浪费，可以为辅助索引建立中间层（桶），相同键值的记录在数据文件中的地址在桶中被连续存储。在索引文件中相同键值的记录只有一条，记录该键值和桶中该键值对应位置的地址。由于索引文件对相同键值的记录只记录一条，且桶中不需要记录键值，可以减少重复值较多场景的空间浪费
- 可以利用辅助索引的中间层，加速一些有多个条件的查询。这些查询条件上若都有可用的辅助索引，可以在主存中将各索引中间层（桶）中指针集合求交集来找到满足所有条件的指针，然后再去数据文件中查找对应记录，可以减少读取数据文件的IO开销

#### 倒排索引

**倒排索引**：在文档检索中，为方便按关键字集高效检索文档，对文档中可能出现的词建立一种关系描述，在该描述关系上建立的一种特殊索引称为倒排索引。

一个文档被看成是关系Doc的一个元组，关系Doc有很多属性，每个属性对应于文档中可能出现的一个词，属性是Bool型的，表明该词是否在该文档中出现，因此，这个关系的模式可被看成：

```
Doc (hasDoc, hasCat, ... )
```

在建立索引时，并不是每个属性建立一个单独的索引，而是吧所有索引合成一个，使用中间层（桶）来提高空间利用率。文档的倒排索引包含：

- 倒排索引，包含词-桶地址对
- 桶，包含指向文档的指针，也可以包含词位置、数量等信息。在桶中，包含同一个词的文档的指针被排在一起，如果一个文档中有多个词，那么在桶中会出现多次
- 文档

在建立倒排索引前，有必要对文档进行预处理，比如抽取词干和删除无用词的处理。

在查找时，当查找关键词有多个时，可以使用指针求交的方式对查询进行加速。

### B树

#### B树的结构

B树把它的存储块组织成一颗平衡树，能够自动地保持与数据文件大小相适应的索引层次。

- 每个B树有一个参数n，描述了B树节点的布局。每个节点存放了n个查找键和n+1个指针。因尽可能一个存储块存放一个B树节点，在每个存储块能存放n个查找键和n+1个指针的前提下，n取得尽可能大
- 叶节点的键是数据文件中键，以排好序的方式分布在叶节点中，至少有$\lfloor (n+1)/2 \rfloor$个被使用
- 叶节点的前n个指针指向数据记录（若无对应键，则为空）。叶节点的最后一个指针指向下一个叶节点
- 内层节点的键用于标识下层节点记录的范围，以排好序的方式分布在内层节点中，至少有$\lfloor (n+1)/2 \rfloor$个被使用
- 内层节点的指针都被用来指向下层的节点。若有m个键被使用，设为$K_1$，$K_2$，……，$K_{m-1}$，则第1个指针指向下层一个节点，所有键值小于$K_1$的记录可从这一节点为祖先节点的叶节点中找到，第2个指针指向下层的另一个节点，所有键值大于等于$K_1$并小于$K_2$的记录可以从这一节点为祖先节点的叶节点中找到，依此类推
- 根节点类似于内层节点，但其键只找有1个被使用

#### B树的应用

#### B树的查找

#### B树的插入

#### B树的删除

#### B树的效率

### 散列表

### 位图索引

### 说明及引用

（本章内容为《数据库系统实现》（第二版）《索引结构》一章的读书笔记，仅为学习目的，如有侵权，请与笔者联系，[http://www.chenyineng.info/techdoc](http://www.chenyineng.info/techdoc)）

[1] 《数据库系统实现》第二版 
